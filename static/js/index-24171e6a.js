var S=(r,g,n)=>new Promise((x,e)=>{var v=s=>{try{m(n.next(s))}catch(u){e(u)}},p=s=>{try{m(n.throw(s))}catch(u){e(u)}},m=s=>s.done?x(s.value):Promise.resolve(s.value).then(v,p);m((n=n.apply(r,g)).next())});import{h as C,c as D,a as E,n as N,o as P}from"./element-plus-a16fcaaf.js";import{f as V,Z as U,a7 as j,e as G,o as c,c as h,a as d,U as b,S as y,a9 as K,u as f,z as H,n as q,P as I,a8 as L,Q as z,W as A,O as J,R as Q,a6 as W,ap as F,aq as X}from"./@vue-b6763d16.js";import{M as Y}from"./markdown-it-f935ff9f.js";import{a as Z}from"./axios-e76ab20a.js";import{_ as $}from"./index-1172c018.js";import"./@element-plus-3d5ed1a4.js";import"./@vueuse-ae6f4f55.js";import"./lodash-es-9cc69f4e.js";import"./@ctrl-86a38320.js";import"./@popperjs-7c8154ca.js";import"./escape-html-8f174268.js";import"./dayjs-3c9a3002.js";import"./normalize-wheel-es-ed76fb12.js";import"./entities-170e234c.js";import"./uc.micro-740ead6f.js";import"./mdurl-d90eb0f0.js";import"./linkify-it-191b779c.js";import"./punycode-ce1d7260.js";import"./pinia-358b124a.js";import"./pinia-plugin-persist-4bd0ee57.js";import"./vue-router-6e50d621.js";const ee=""+new URL("../png/1-eac96604.png",import.meta.url).href;const te=r=>(F("data-v-b3961f10"),r=r(),X(),r),se={class:"box"},oe={id:"chatbox"},ae={key:0,class:"robot"},ne=te(()=>d("img",{class:"avatar",src:ee},null,-1)),re={class:"msg-name"},le=["innerHTML"],ie={id:"inputbox"},ce={__name:"index",setup(r){const g=V(),n=V(),x=new Y,e=U({messages:[{id:1,name:"GPT-3.5",text:"Hello",isOther:!0},{id:2,name:"GPT-3.5",text:"Hi",isOther:!1},{id:3,name:"GPT-3.5",text:"How are you?",isOther:!0},{id:4,name:"GPT-3.5",text:"I'm good, thanks!",isOther:!1}],newMessage:"",loading:!1,select:"gpt-3.5-turbo-0613",selectList:[]}),{messages:v,newMessage:p,loading:m,select:s,selectList:u}=j(e);G(()=>S(this,null,function*(){Z.get("https://kmapi-6bd1.onrender.com/models").then(({data:a})=>{e.selectList=a.data})}));function T(){return S(this,null,function*(){if(e.newMessage.trim()!==""){e.loading=!0,e.messages.push({id:e.messages.length+1,text:e.newMessage,isOther:!1}),R();const a=JSON.stringify({model:e.select,messages:[{role:"user",content:e.newMessage}],temperature:.7,stream:!0});try{const o=yield fetch("https://api.chatanywhere.com.cn/v1/chat/completions",{method:"POST",body:a,headers:{Authorization:"Bearer sk-ADjDpi2dQxYS186eDyx0aiIRcpty65qWDvjaKqnmgd67hbsX","Content-Type":"application/json"}});e.newMessage="";const l=o.body.getReader();e.messages.push({id:1,text:"",name:e.select,isOther:!0});let w=e.messages[e.messages.length-1];for(;;){const{done:k,value:O}=yield l.read();if(k){e.loading=!1;break}let i=new TextDecoder().decode(O),t=i.split("data:");for(let M=0;M<t.length;M++){if(i=t[M].replace(/\s*/,"").replace(/\s*$/,""),!i)continue;let _=JSON.parse(i);_&&_.choices[0].delta&&_.choices[0].delta.content!=null&&_.choices[0].delta.content!="undefined"&&(w.text+=_.choices[0].delta.content,R())}}}catch(o){console.error(o),e.loading=!1}}})}function R(){q(()=>{var a,o,l;((a=n.value)==null?void 0:a.clientHeight)>400&&((l=g.value)==null||l.setScrollTop((o=n.value)==null?void 0:o.clientHeight))})}function B(a){return x.render(a)}return(a,o)=>{const l=C,w=N,k=P,O=D,i=E;return c(),h("div",se,[d("div",oe,[b(l,{ref_key:"scrollbarRef",ref:g,height:"580"},{default:y(()=>[d("div",{ref_key:"innerRef",ref:n},[(c(!0),h(I,null,L(f(v),t=>(c(),h("div",{key:t.id,class:z(["msg",{"message-left":t.isOther,"message-right":!t.isOther}])},[t.isOther?(c(),h("div",ae,[ne,d("div",re,A(t.name.toUpperCase()),1)])):J("",!0),d("div",{class:"message-bubble",innerHTML:B(t.text)},null,8,le)],2))),128))],512)]),_:1},512)]),d("div",ie,[b(O,{placeholder:"Type your message here",onKeyup:K(T,["enter"]),modelValue:f(p),"onUpdate:modelValue":o[1]||(o[1]=t=>H(p)?p.value=t:null),class:"input-with-select"},{prepend:y(()=>[b(k,{modelValue:f(s),"onUpdate:modelValue":o[0]||(o[0]=t=>H(s)?s.value=t:null),placeholder:"请选择模型"},{default:y(()=>[(c(!0),h(I,null,L(f(u),t=>(c(),Q(w,{key:t.id,label:t.id,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["onKeyup","modelValue"]),b(i,{class:"ipt-btn",type:"primary",onClick:T,loading:f(m)},{default:y(()=>[W("发送")]),_:1},8,["loading"])])])}}},Le=$(ce,[["__scopeId","data-v-b3961f10"]]);export{Le as default};

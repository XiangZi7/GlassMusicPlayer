import{e,f as t,h as s,q as a,s as n,d as o,v as i,r as l,o as r,x as d,E as c,_ as u,b as v,i as h,y as p,F as m,k as g,w as f,z as b,m as x,A as w,B as y,C as k,j as C,l as T}from"./index-D5TMCQ31.js";const M={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};const V={name:"tabler-settings",render:function(a,n){return e(),t("svg",M,n[0]||(n[0]=[s("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[s("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065"}),s("path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0"})],-1)]))}},I={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};const _={name:"iconoir-send-diagonal",render:function(a,n){return e(),t("svg",I,n[0]||(n[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M22.153 3.553L11.176 21.004l-1.67-8.596L2 7.898zM9.456 12.444l12.696-8.89"},null,-1)]))}},S={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};const B={name:"tabler-trash",render:function(a,n){return e(),t("svg",S,n[0]||(n[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7h16m-10 4v6m4-6v6M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-12M9 7V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"},null,-1)]))}},j={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};const U={name:"tabler-brand-wechat",render:function(a,n){return e(),t("svg",j,n[0]||(n[0]=[s("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[s("path",{d:"M16.5 10c3.038 0 5.5 2.015 5.5 4.5c0 1.397-.778 2.645-2 3.47V20l-1.964-1.178A6.7 6.7 0 0 1 16.5 19c-3.038 0-5.5-2.015-5.5-4.5s2.462-4.5 5.5-4.5"}),s("path",{d:"M11.197 15.698c-.69.196-1.43.302-2.197.302a8 8 0 0 1-2.612-.432L4 17v-2.801C2.763 13.117 2 11.635 2 10c0-3.314 3.134-6 7-6c3.782 0 6.863 2.57 7 5.785v.233M10 8h.01M7 8h.01M15 14h.01M18 14h.01"})],-1)]))}},A={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};const z={name:"material-symbols-light-add-circle-outline-rounded",render:function(a,n){return e(),t("svg",A,n[0]||(n[0]=[s("path",{fill:"currentColor",d:"M11.5 12.5V16q0 .213.144.356t.357.144t.356-.144T12.5 16v-3.5H16q.213 0 .356-.144t.144-.357t-.144-.356T16 11.5h-3.5V8q0-.213-.144-.356t-.357-.144t-.356.144T11.5 8v3.5H8q-.213 0-.356.144t-.144.357t.144.356T8 12.5zm.503 8.5q-1.867 0-3.51-.708q-1.643-.709-2.859-1.924t-1.925-2.856T3 12.003t.709-3.51Q4.417 6.85 5.63 5.634t2.857-1.925T11.997 3t3.51.709q1.643.708 2.859 1.922t1.925 2.857t.709 3.509t-.708 3.51t-1.924 2.859t-2.856 1.925t-3.509.709M12 20q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}},P=a({id:"useChatStore",state:()=>({apiBaseUrl:"https://api.chatanywhere.tech",apiToken:"",conversations:[{id:1,messages:[{role:"system",content:"You are a helpful assistant."}]}],activeConversationId:0,modelSelect:"gpt-3.5-turbo-1106"}),actions:{setApiBaseUrl(e){this.apiBaseUrl=e},setApiToken(e){this.apiToken=e},addConversation(){const e=this.conversations.length+1;this.conversations.push({id:e,messages:[]}),this.activeConversationId=this.conversations.length-1},deleteConversation(e){1===this.conversations.length?(this.conversations=[],this.activeConversationId=-1):(this.conversations.splice(e,1),this.activeConversationId>=e&&(this.activeConversationId=Math.max(0,this.activeConversationId-1)))}},persist:n("ChatStore")}),q={class:"flex flex-1 h-full"},$={class:"bg-white border-r border-gray-200 w-72 flex flex-col transition-all duration-300 ease-in-out translate-x-0 md:translate-x-0 md:static absolute z-10 h-full"},N={class:"p-4 border-b"},D={class:"relative overflow-auto flex-1"},L={class:"h-full w-full rounded-[inherit]"},O={style:{"min-width":"100%",display:"table"}},F=["onClick","onMouseover"],H={class:"flex items-center justify-between w-full"},E={class:"flex items-center gap-1 line-clamp-1"},G=["onClick"],J={class:"flex-1 flex flex-col"},K={class:"bg-white border-b p-4 flex items-center justify-between"},Q={class:"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"},R={class:"relative overflow-hidden flex-1 p-4 bg-[#F9FAFB]"},W={class:"h-full w-full rounded-[inherit] overflow-auto"},Y={style:{"min-width":"100%",display:"table"}},X={key:0,class:"text-center p-4"},Z={class:"flex items-start max-w-[80%]"},ee={key:0,class:"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full mt-1 mx-2"},te={class:"mb-1"},se={key:1,class:"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full mt-1 mx-2"},ae={class:"p-4 bg-white"},ne={class:"flex items-center"};const oe=u(o({__name:"index",setup(e,{expose:t}){t();const s=P(),{conversations:a,activeConversationId:n,modelSelect:o,apiBaseUrl:u,apiToken:v}=i(s),h=l(!1),p=l([]),m=l(""),g=l(-1),f=async(e,t)=>{for(var s,o;;){const{done:l,value:r}=await e.read();if(l)break;const d=t.decode(r,{stream:!0}).split("\n").filter((e=>""!==e.trim()));for(const e of d)if(e.startsWith("data: ")){const t=e.substring(6).trim();if(t&&"[DONE]"!==t)try{const e=(null==(o=null==(s=JSON.parse(t).choices[0])?void 0:s.delta)?void 0:o.content)||"",i=a.value[n.value].messages.length;a.value[n.value].messages[i-1].content+=e}catch(i){}}}};r((()=>{d.get(`${s.apiBaseUrl}/v1/models`,{headers:{Authorization:s.apiToken}}).then((e=>{p.value=e.data.data})).catch((e=>{}))}));const b={chatStore:s,conversations:a,activeConversationId:n,modelSelect:o,apiBaseUrl:u,apiToken:v,dialogVisible:h,modelList:p,newMessage:m,hoveredIndex:g,sendMessage:async()=>{var e;if(!m.value)return;const t={role:"user",content:m.value};s.conversations[s.activeConversationId].messages.push(t);const o=JSON.stringify({model:s.modelSelect,messages:s.conversations[s.activeConversationId].messages,stream:!0});try{const t=await fetch(`${s.apiBaseUrl}/v1/chat/completions`,{method:"POST",headers:{Authorization:s.apiToken,"Content-Type":"application/json"},body:o});t.ok||t.json().then((({error:e})=>{const{message:t,code:s}=e;throw c({title:"HTTP 错误！状态:",message:`${s} - ${t}`,type:"error"}),new Error(`HTTP 错误！状态: ${s} - ${t}`)}));const i=null==(e=t.body)?void 0:e.getReader(),l=new TextDecoder("utf-8"),r={role:"system",content:""};a.value[n.value].messages.push(r),await f(i,l)}catch(i){}finally{m.value=""}},processStreamedData:f,openSettingsDialog:()=>{h.value=!0},saveSettings:()=>{h.value=!1,s.setApiBaseUrl(u.value),s.setApiToken(v.value)},createNewChat:()=>{s.addConversation()},deleteChat:e=>{s.deleteConversation(e)}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),[["render",function(a,n,o,i,l,r){const d=z,c=U,u=B,M=v("el-avatar"),I=v("el-option"),S=v("el-select"),j=v("el-input"),A=_,P=V,oe=v("el-button"),ie=v("el-dialog");return e(),t("div",q,[s("div",$,[s("div",N,[s("button",{onClick:i.createNewChat,class:"inline-flex items-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 h-10 px-4 py-2 w-full justify-start bg-purple-600 hover:bg-purple-700 text-white"},[h(d),n[7]||(n[7]=p(" New Chat "))])]),s("div",D,[s("div",L,[s("div",O,[(e(!0),t(m,null,g(i.conversations,((a,o)=>(e(),t("div",{class:b(`p-3 cursor-pointer hover:bg-gray-100 transition-colors duration-200 ${i.activeConversationId===o?"bg-purple-100 text-purple-800":"duration-200 text-gray-700"} flex items-center gap-2`),key:a.id,onClick:e=>i.chatStore.activeConversationId=o,onMouseover:e=>i.hoveredIndex=o,onMouseleave:n[0]||(n[0]=e=>i.hoveredIndex=-1)},[s("div",H,[s("div",E,[h(c),p(" "+x(a.messages.length>0&&a.messages[0].content?a.messages[0].content:"空消息"),1)]),w(s("button",{onClick:k((e=>i.deleteChat(o)),["stop"]),class:"ml-2 text-red-500 hover:text-red-700"},[h(u)],8,G),[[y,i.hoveredIndex===o]])])],42,F)))),128))])])])]),s("div",J,[s("header",K,[n[8]||(n[8]=s("div",{class:"flex items-center"},[s("h1",{class:"text-xl font-semibold text-gray-800"},"General Questions")],-1)),s("span",Q,[h(M,{src:"src/assets/gthub-avatar.png"})])]),s("div",R,[s("div",W,[s("div",Y,[0===i.conversations[i.activeConversationId].messages.length?(e(),t("div",X,n[9]||(n[9]=[s("p",{class:"text-gray-500"},"开始聊天，输入你的问题...",-1)]))):(e(!0),t(m,{key:1},g(i.conversations[i.activeConversationId].messages,(a=>(e(),t("div",{class:b("mb-4 flex "+("system"===a.role?"justify-start":"justify-end")),key:a.content},[s("div",Z,["system"===a.role?(e(),t("span",ee,[h(M,{src:"src/assets/gthub-avatar.png"})])):C("",!0),s("div",{class:b("p-3 rounded-lg "+("system"===a.role?"bg-white border border-gray-200 text-gray-800":"bg-purple-600 text-white"))},[s("p",te,x(a.content),1)],2),"user"===a.role?(e(),t("span",se,[h(M,{src:"src/assets/gthub-avatar.png"})])):C("",!0)])],2)))),128))])])]),s("div",ae,[s("div",ne,[h(j,{size:"large",placeholder:"Type your message here...",modelValue:i.newMessage,"onUpdate:modelValue":n[2]||(n[2]=e=>i.newMessage=e)},{append:f((()=>[h(S,{modelValue:i.modelSelect,"onUpdate:modelValue":n[1]||(n[1]=e=>i.modelSelect=e),placeholder:"Model",size:"large",style:{width:"215px"}},{default:f((()=>[(e(!0),t(m,null,g(i.modelList,(t=>(e(),T(I,{key:t.id,label:t.id,value:t.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),s("button",{onClick:i.sendMessage,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 h-10 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white"},[h(A)]),s("button",{onClick:i.openSettingsDialog,class:"ml-2 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 h-10 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white"},[h(P)])])])]),h(ie,{title:"API 设置",modelValue:i.dialogVisible,"onUpdate:modelValue":n[6]||(n[6]=e=>i.dialogVisible=e)},{footer:f((()=>[h(oe,{onClick:n[5]||(n[5]=e=>i.dialogVisible=!1)},{default:f((()=>n[10]||(n[10]=[p("取消")]))),_:1}),h(oe,{type:"primary",onClick:i.saveSettings},{default:f((()=>n[11]||(n[11]=[p("保存")]))),_:1})])),default:f((()=>[h(j,{modelValue:i.apiBaseUrl,"onUpdate:modelValue":n[3]||(n[3]=e=>i.apiBaseUrl=e),class:"mb-4",placeholder:"输入 API 基础地址"},null,8,["modelValue"]),h(j,{modelValue:i.apiToken,"onUpdate:modelValue":n[4]||(n[4]=e=>i.apiToken=e),placeholder:"输入 API Token",type:"textarea",class:"mb-4",rows:2},null,8,["modelValue"]),n[12]||(n[12]=s("span",{class:"text-gray-600 text-sm"},"请确保正确输入 API 地址和 Token。",-1))])),_:1},8,["modelValue"])])}],["__file","/home/runner/work/KMMusicPlayer/KMMusicPlayer/src/views/chatGPT/index.vue"]]);export{oe as default};

var $=(u,M,c)=>new Promise((x,r)=>{var b=g=>{try{f(c.next(g))}catch(V){r(V)}},k=g=>{try{f(c.throw(g))}catch(V){r(V)}},f=g=>g.done?x(g.value):Promise.resolve(g.value).then(b,k);f((c=c.apply(u,M)).next())});import"./vue-QRcACDZS.js";import{o as d,c as m,a as e,av as _e,$ as Q,af as Z,as as fe,e as w,V as j,a8 as U,u as p,G as I,U as B,a6 as E,Y as q,b as ee,aq as te,ar as se,r as C,g as ae,w as ye,aw as oe,q as we,n as X,R as Me,S as xe}from"./@vue-pciPq-Ev.js";import{o as le,i as ne,p as ke,h as be,q as Ve,r as Se}from"./element-plus-HgVO88ID.js";import{_ as ie,m as Y,f as Ce}from"./index-n86nP3Cr.js";import{M as De}from"./markdown-it-nrbwsrMi.js";import{H as N}from"./highlight.js-0oa-KBSY.js";import{a as F}from"./axios-52F-EHG1.js";import{n as H}from"./nprogress-1-LfP57V.js";import"./@element-plus-jC-WUTAd.js";import"./@vueuse-aTQAE_yp.js";import"./lodash-es-DA4vajO2.js";import"./@ctrl--dareiTT.js";import"./@popperjs-NiN61gaS.js";import"./memoize-one-JaOscZgY.js";import"./pinia-2idKN3M1.js";import"./vue-router-d3mNYdNn.js";import"./pinia-plugin-persistedstate-XbYvz584.js";import"./@babel-3yCADe9Y.js";import"./mdurl-9k46EItm.js";import"./uc.micro-ACIubxMQ.js";import"./entities-Magy3A7t.js";import"./linkify-it-YB6gZgM7.js";import"./punycode.js-rvxP7Hxc.js";const Te={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$e=e("g",{fill:"none","fill-rule":"evenodd"},[e("path",{d:"M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"}),e("path",{fill:"currentColor",d:"M14.41 2.293a9.946 9.946 0 0 1 2.75 1.14a1 1 0 0 1 .47 1.019c-.113.689.059 1.216.38 1.538c.322.322.85.493 1.538.38a1 1 0 0 1 1.02.47a9.948 9.948 0 0 1 1.14 2.75a1 1 0 0 1-.388 1.054c-.568.407-.82.9-.82 1.356c0 .456.252.95.82 1.357a1 1 0 0 1 .388 1.053a9.947 9.947 0 0 1-1.14 2.75a1 1 0 0 1-1.02.47c-.689-.113-1.215.059-1.537.38c-.322.322-.494.85-.38 1.538a1 1 0 0 1-.47 1.02a9.948 9.948 0 0 1-2.752 1.14a1 1 0 0 1-1.053-.388c-.406-.568-.9-.82-1.356-.82c-.455 0-.95.252-1.356.82a1 1 0 0 1-1.053.388a9.948 9.948 0 0 1-2.752-1.14a1 1 0 0 1-.47-1.02c.114-.688-.057-1.215-.38-1.537c-.321-.322-.848-.494-1.537-.38a1 1 0 0 1-1.019-.47a9.947 9.947 0 0 1-1.14-2.752a1 1 0 0 1 .388-1.053c.567-.406.82-.9.82-1.356c0-.455-.253-.95-.82-1.356a1 1 0 0 1-.388-1.053a9.946 9.946 0 0 1 1.14-2.751a1 1 0 0 1 1.019-.47c.689.113 1.216-.058 1.538-.38c.322-.322.493-.85.38-1.538a1 1 0 0 1 .47-1.019a9.947 9.947 0 0 1 2.75-1.14a1 1 0 0 1 1.054.388c.407.567.9.82 1.356.82c.456 0 .95-.253 1.357-.82a1 1 0 0 1 1.053-.388m.102 2.11C13.855 5.06 12.992 5.5 12 5.5s-1.855-.439-2.512-1.098a7.944 7.944 0 0 0-1.084.45c.001.93-.299 1.85-1 2.552c-.701.701-1.622 1.001-2.552 1c-.176.348-.326.71-.45 1.084c.659.657 1.098 1.52 1.098 2.512s-.439 1.855-1.098 2.512c.124.374.275.737.45 1.085c.93-.002 1.85.298 2.552 1c.701.7 1.001 1.621 1 2.551c.347.176.71.326 1.084.45c.657-.659 1.52-1.098 2.512-1.098s1.855.44 2.512 1.098a7.943 7.943 0 0 0 1.085-.45c-.002-.93.298-1.85 1-2.552c.7-.701 1.621-1 2.551-1c.176-.347.326-.71.45-1.084c-.659-.657-1.098-1.52-1.098-2.512s.44-1.855 1.098-2.512a7.94 7.94 0 0 0-.45-1.084c-.93.001-1.85-.299-2.552-1c-.701-.701-1-1.622-1-2.552a7.945 7.945 0 0 0-1.084-.45ZM12 8a4 4 0 1 1 0 8a4 4 0 0 1 0-8m0 2a2 2 0 1 0 0 4a2 2 0 0 0 0-4"})],-1),je=[$e];function qe(u,M){return d(),m("svg",Te,[...je])}const Ie={name:"mingcute-settings5-line",render:qe},ce="/static/png/1-jW5SUX1G.png",Ae={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Be=e("path",{fill:"currentColor",d:"M7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H20v15q-.625 0-1.062.438T18.5 18.5q0 .625.438 1.063T20 20v2zM6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 20h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20"},null,-1),Ee=[Be];function ze(u,M){return d(),m("svg",Ae,[...Ee])}const He={name:"material-symbols-book2-outline",render:ze},Oe=[{title:"格式",icon:"pi pi-book fs-color",buttons:[{label:"评论",severity:"secondary",icon:"pi pi-check",en:"Write a comment"},{label:"邮箱",severity:"secondary",icon:"pi pi-check",en:"Write a email"},{label:"消息",severity:"secondary",icon:"pi pi-check",en:"Write a SMS"}]},{title:"语气",icon:"pi pi-book fs-color",buttons:[{label:"正式的",severity:"secondary",icon:"pi pi-check",en:"with formal tone"},{label:"随意的",severity:"secondary",icon:"pi pi-check",en:"with casual tone"}]},{title:"长度",icon:"pi pi-book fs-color",buttons:[{label:"短",severity:"secondary",en:"short length"},{label:"中等",severity:"secondary",en:"medium length"},{label:"长",severity:"secondary",en:"long length"}]}],G=u=>(te("data-v-df95ac33"),u=u(),se(),u),Pe=G(()=>e("div",{class:"m-1"},[e("i",{class:"pi pi-book fs-color"}),e("span",{class:"fs-color ml-1"},"CDK")],-1)),Re=G(()=>e("div",{class:"m-1"},[e("i",{class:"pi pi-book fs-color"}),e("span",{class:"fs-color ml-1"},"写作")],-1)),Le={class:"fs-color ml-1"},Ne={class:"row gap-2"},Ue={class:"m-1"},Ge=G(()=>e("span",{class:"fs-color ml-1"},"AI绘制",-1)),Ke={class:"flex flex-items-center"},We={__name:"setting",props:{modelValue:{},modelModifiers:{}},emits:_e(["send"],["update:modelValue"]),setup(u,{emit:M}){const c=Q({Message:"",loading:!1,buttonGroupss:Oe,checked:!1,cdk:""}),{cdk:x,Message:r,buttonGroupss:b,checked:k}=Z(c),f=fe(u,"modelValue"),g=M;function V(){const v=[];c.buttonGroupss.forEach(i=>{i.buttons.forEach(l=>{l.severity=="success"&&v.push(l.en)})}),g("send",{keyword:v.join(" ")+c.Message,isDraw:c.checked,cdk:c.cdk}),f.value=!1}function t(v,i){let a=c.buttonGroupss[v].buttons[i].severity==="success"?"secondary":"success";c.buttonGroupss[v].buttons.forEach((h,y)=>{h.severity=y===i?a:"secondary"})}return(v,i)=>{const l=le,a=ne,h=He,y=ke,A=be;return d(),m("div",null,[w(A,{modelValue:f.value,"onUpdate:modelValue":i[3]||(i[3]=_=>f.value=_),maximizable:"",modal:"",style:{width:"50%"}},{footer:j(()=>[w(a,{onClick:V},{default:j(()=>[U(" OK ")]),_:1})]),default:j(()=>[e("div",null,[Pe,w(l,{modelValue:p(x),"onUpdate:modelValue":i[0]||(i[0]=_=>I(x)?x.value=_:null),class:"w-full",style:{"max-height":"45px",margin:"0 5px"}},null,8,["modelValue"]),Re,w(l,{modelValue:p(r),"onUpdate:modelValue":i[1]||(i[1]=_=>I(r)?r.value=_:null),type:"textarea",class:"w-full",style:{"max-height":"45px",margin:"0 5px"},disabled:"",placeholder:"你的其他需求...需求空格隔开如： 搞笑的 可爱的"},null,8,["modelValue"]),(d(!0),m(B,null,E(p(b),(_,P)=>(d(),m("div",{key:_.title,class:"m-1"},[e("span",Le,q(_.title),1),e("div",Ne,[(d(!0),m(B,null,E(_.buttons,(S,z)=>(d(),ee(a,{key:S.label,style:{padding:"5px"},severity:S.severity,type:"primary",onClick:R=>t(P,z)},{default:j(()=>[U(q(S.label),1)]),_:2},1032,["severity","onClick"]))),128))])]))),128)),e("div",Ue,[w(h),Ge]),e("div",Ke,[w(y,{modelValue:p(k),"onUpdate:modelValue":i[2]||(i[2]=_=>I(k)?k.value=_:null)},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}},Je=ie(We,[["__scopeId","data-v-df95ac33"],["__file","/home/runner/work/KM-Music-Player/KM-Music-Player/src/pages/chat/components/setting.vue"]]),Xe=(u,M)=>{const c=C("gpt-3.5-turbo-0613"),x=C([]),r=C(!1),b=C(""),k=C("");function f(){F({method:"get",url:"https://api.chatanywhere.com.cn/v1/models",headers:{Authorization:"Bearer sk-ADjDpi2dQxYS186eDyx0aiIRcpty65qWDvjaKqnmgd67hbsX","Content-Type":"application/json"},timeout:5e3}).then(({data:a})=>{x.value=a.data}).catch(function(a){console.log(a)})}function g(l){return $(this,null,function*(){b.value="",r.value=!0;try{H.start();const a=yield fetch("https://api.chatanywhere.com.cn/v1/chat/completions",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Authorization:"Bearer sk-ADjDpi2dQxYS186eDyx0aiIRcpty65qWDvjaKqnmgd67hbsX"}});if(H.done(),a.status===429){v("请求频率过快，请稍后重试");return}yield V(a)}catch(a){console.error("Fetching error:",a)}finally{r.value=!1}})}function V(l){return $(this,null,function*(){const a=l.body.getReader();for(;;){const{done:h,value:y}=yield a.read();if(h){console.log("Stream ended");break}b.value=t(y),u()}})}function t(l){return new TextDecoder().decode(l).split("data:").map(h=>h.trim()).filter(h=>h&&h!=="[DONE]").map(h=>{try{const y=JSON.parse(h);return y.choices[0].delta&&y.choices[0].delta.content||""}catch(y){return console.error("Error parsing JSON:",y),""}}).join("")}function v(l){console.log("=>(useChat.js:150) msg",l),M(l),r.value=!1}function i(l){return $(this,null,function*(){try{r.value=!0,H.start();const a=yield F({url:"http://8.218.198.198:8094/ai/v1/image",method:"post",headers:{Authorization:"Basic cXExMjM0NTY6cXExMjM0NTY=","Content-Type":"application/json"},data:{messages:l}});k.value=JSON.parse(a.data).data[0].url}catch(a){console.error("An error occurred: ",a),v("文本中有敏感词")}finally{r.value=!1,H.done()}})}return ae(()=>{f()}),{select:c,selectList:x,loading:r,sendMessage:g,lastMessage:b,aiDraw:i,Drawimg:k}},O=u=>(te("data-v-da04a0a0"),u=u(),se(),u),Ye={class:"app"},Fe=oe('<div class="header" data-v-da04a0a0><div class="logo" data-v-da04a0a0><svg viewBox="0 0 513 513" fill="currentColor" xmlns="http://www.w3.org/2000/svg" data-v-da04a0a0><path d="M256.025.05C117.67-2.678 3.184 107.038.025 245.383a240.703 240.703 0 0085.333 182.613v73.387c0 5.891 4.776 10.667 10.667 10.667a10.67 10.67 0 005.653-1.621l59.456-37.141a264.142 264.142 0 0094.891 17.429c138.355 2.728 252.841-106.988 256-245.333C508.866 107.038 394.38-2.678 256.025.05z" data-v-da04a0a0></path><path d="M330.518 131.099l-213.825 130.08c-7.387 4.494-5.74 15.711 2.656 17.97l72.009 19.374a9.88 9.88 0 007.703-1.094l32.882-20.003-10.113 37.136a9.88 9.88 0 001.083 7.704l38.561 63.826c4.488 7.427 15.726 5.936 18.003-2.425l65.764-241.49c2.337-8.582-7.092-15.72-14.723-11.078zM266.44 356.177l-24.415-40.411 15.544-57.074c2.336-8.581-7.093-15.719-14.723-11.078l-50.536 30.744-45.592-12.266L319.616 160.91 266.44 356.177z" fill="#fff" data-v-da04a0a0></path></svg></div><div class="search-bar" data-v-da04a0a0><input type="text" placeholder="Search..." data-v-da04a0a0></div></div>',1),Qe={class:"wrapper"},Ze={class:"conversation-area"},et=["onMousemove","onClick"],tt=O(()=>e("div",{class:"yx-col-6"},[e("div",{class:"msg-profile group"},[e("img",{class:"chat-msg-img",src:ce,alt:""})])],-1)),st={class:"msg-detail flex-1"},at={class:"flex justify-content-between w-full flex-items-center"},ot={class:"msg-username"},lt=["onClick"],nt={class:"msg-content"},it={class:"msg-message"},ct=O(()=>e("span",{class:"msg-date"},"1s",-1)),rt={class:"chat-area-header"},dt={class:"chat-area-title"},ut={class:"chat-msg-profile"},ht=O(()=>e("img",{class:"chat-msg-img",src:ce},null,-1)),pt={class:"chat-msg-date"},mt={class:"chat-msg-content"},gt=["innerHTML"],vt=["innerHTML"],_t={key:2,class:"chat-msg-text flex items-center",style:{height:"260px"}},ft=["src"],yt={class:"chat-area-footer"},wt=oe('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image" data-v-da04a0a0><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-da04a0a0></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-da04a0a0></circle><path d="M21 15l-5-5L5 21" data-v-da04a0a0></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle" data-v-da04a0a0><circle cx="12" cy="12" r="10" data-v-da04a0a0></circle><path d="M12 8v8M8 12h8" data-v-da04a0a0></path></svg>',2),Mt=O(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-smile"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01"})],-1)),xt={__name:"index",setup(u){const M=C(),c=C(),{selectList:x,select:r,loading:b,sendMessage:k,lastMessage:f,aiDraw:g,Drawimg:V}=Xe(P,he),t=Q({messages:[{title:"默认会话",messages:[]}],currentActivity:0,newMessage:"",showSetting:!1,settingMsg:"",hoveredMessageIndex:-1,isDraw:!1,isVIP:!1}),{messages:v,showSetting:i,newMessage:l,currentActivity:a,hoveredMessageIndex:h}=Z(t);ae(()=>$(this,null,function*(){N.highlightAll()})),ye(()=>f.value,()=>{let s=t.messages[t.currentActivity].messages.length;t.messages[t.currentActivity].messages[s-1].text+=f.value});function y(){return $(this,null,function*(){if(!t.isVIP)return Y(1,"请前往发送右边的设置按钮输入正确CDK");if(t.newMessage.trim()==="")return;const s=A(t.newMessage,"right");t.messages[t.currentActivity].messages.push(s),S();const n=_();if(t.isDraw){yield g(t.newMessage);const D=A(V.value,"left");t.messages[t.currentActivity].messages.push(D),S()}else{k(n);const D=A("","left");t.messages[t.currentActivity].messages.push(D),t.newMessage=""}})}function A(s,n){return{id:t.messages[t.currentActivity].messages.length+1,text:s,isOther:n!="right",date:Ce(),isDraw:t.isDraw}}function _(){return{messages:t.messages[t.currentActivity].messages.filter(s=>!s.isDraw).map(s=>({role:s.isOther?"assistant":"user",content:t.settingMsg?t.settingMsg+s.text:s.text})),stream:!0,temperature:.7,model:r.value}}function P(){S()}function S(){we(()=>{var s,n;((s=c.value)==null?void 0:s.clientHeight)>400&&(M.value.scrollTop=(n=c.value)==null?void 0:n.clientHeight)})}const z=new De({highlight:function(s,n){if(n&&N.getLanguage(n))try{return'<pre class="hljs"><code>'+N.highlight(s,{language:n,ignoreIllegals:!0}).value+"</code></pre>"}catch(D){}return'<pre class="hljs"><code>'+z.utils.escapeHtml(s)+"</code></pre>"}});function R(s){return z.render(s)}function re(s){t.isDraw=s.isDraw,s.cdk=="yxcr666"?t.isVIP=!0:t.isVIP=!1,s.keyword?t.settingMsg=s.keyword+"Output in Chinese(Simplified) The topic is: ":t.settingMsg=""}function de(){t.messages.push({title:`默认会话${t.messages.length}`,messages:[]})}function ue(s){t.messages.splice(s,1)}function he(s){Y(1,s)}return(s,n)=>{var K,W;const D=Se,pe=Ve,me=le,ge=ne,ve=Ie;return d(),m("div",Ye,[Fe,e("div",Qe,[e("div",Ze,[(d(!0),m(B,null,E(p(v),(o,T)=>{var J;return d(),m("div",{key:T,class:X(["msg online",{active:p(a)==T}]),onMousemove:L=>h.value=T,onMouseout:n[0]||(n[0]=L=>h.value=-1),onClick:L=>a.value=T},[tt,e("div",st,[e("div",at,[e("div",ot,q(o.title),1),Me(e("i",{class:"pi pi-times",onClick:L=>ue(T)},null,8,lt),[[xe,p(h)===T]])]),e("div",nt,[e("span",it,q((J=o.messages[o.messages.length-1])==null?void 0:J.text),1),ct])])],42,et)}),128)),e("button",{class:"add",onClick:de})]),e("div",{ref_key:"scrollbarRef",ref:M,class:"chat-area"},[e("div",rt,[e("div",dt,q((K=p(v)[p(a)])==null?void 0:K.title),1)]),e("div",{ref_key:"innerRef",ref:c,class:"chat-area-main h-full flex-1 overflow-y-auto"},[(d(!0),m(B,null,E((W=p(v)[p(a)])==null?void 0:W.messages,o=>(d(),m("div",{key:o.id,class:X(["chat-msg",{owner:!o.isOther}])},[e("div",ut,[ht,e("div",pt,q(o.date),1)]),e("div",mt,[o.isDraw?o.isDraw&&!o.isOther?(d(),m("div",{key:1,class:"chat-msg-text",innerHTML:R(o.text)},null,8,vt)):(d(),m("div",_t,[e("img",{src:o.text,alt:"Image",class:"rounded-xl"},null,8,ft)])):(d(),m("div",{key:0,class:"chat-msg-text p-2",innerHTML:R(o.text)},null,8,gt))])],2))),128))],512),e("div",yt,[wt,w(pe,{modelValue:p(r),"onUpdate:modelValue":n[1]||(n[1]=o=>I(r)?r.value=o:null),class:"m-2",placeholder:"Select",size:"large",style:{width:"140px"}},{default:j(()=>[(d(!0),m(B,null,E(p(x),o=>(d(),ee(D,{key:o.id,label:o.id,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),w(me,{modelValue:p(l),"onUpdate:modelValue":n[2]||(n[2]=o=>I(l)?l.value=o:null),type:"textarea",class:"flex-1",disabled:p(b),placeholder:"Type something here..."},null,8,["modelValue","disabled"]),w(ge,{type:"primary",onClick:y},{default:j(()=>[U(" 发送 ")]),_:1}),Mt,w(ve,{class:"text-xl",onClick:n[3]||(n[3]=o=>i.value=!0)})])],512)]),w(Je,{modelValue:p(i),"onUpdate:modelValue":n[4]||(n[4]=o=>I(i)?i.value=o:null),onSend:re},null,8,["modelValue"])])}}},Wt=ie(xt,[["__scopeId","data-v-da04a0a0"],["__file","/home/runner/work/KM-Music-Player/KM-Music-Player/src/pages/chat/index.vue"]]);export{Wt as default};
